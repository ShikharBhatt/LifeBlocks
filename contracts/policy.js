const Tx = require("ethereumjs-tx");
const Web3 = require("web3");
const web3 = new Web3("http://127.0.0.1:7545");

const government = "0x5578Ec2cb3994BC87823802071241726EBC40FDF";

const privateKeyGovernment = Buffer.from(process.env.PRIVATE_KEY, "hex");

//console.log(privateKeyGovernment)
const data = "0x608060405234801561001057600080fd5b5033600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550611598806100616000396000f300608060405260043610610078576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063327097381461007d5780636db026f2146100d45780636ebc8c8614610141578063893d20e8146101ae5780638ae2dc94146102055780639399869d1461026f575b600080fd5b34801561008957600080fd5b5061009261029a565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b3480156100e057600080fd5b506100ff600480360381019080803590602001909291905050506102c0565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561014d57600080fd5b5061016c600480360381019080803590602001909291905050506102fe565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b3480156101ba57600080fd5b506101c361039d565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61022d60048036038101908080359060200190929190803590602001909291905050506103c7565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561027b57600080fd5b506102846105b2565b6040518082815260200191505060405180910390f35b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000818154811015156102cf57fe5b906000526020600020016000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561035c57600080fd5b60008281548110151561036b57fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b600080670de0b6b3a7640000341415156103e057600080fd5b3433600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168661040e61061b565b808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200193505050506040518091039082f080158015610499573d6000803e3d6000fd5b509050905060008190806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507fda4818c66aa618a1523d98d1970df0be840e6ab133d89f526b0b8ac6b323761381604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a18091505092915050565b6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561061057600080fd5b600080549050905090565b604051610f418061062c8339019056006080604052604051606080610f4183398101806040528101908080519060200190929190805190602001909291908051906020019092919050505082600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503460008190555081600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555042600581905550806004819055506000600b60006101000a81548160ff021916908360068111156100f057fe5b0217905550505050610e3a806101076000396000f3006080604052600436106100c5576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806308551a53146100ca578063105f69ac1461012157806310ec214f1461014e57806349b1b0111461017b5780634ad42dbd146101a85780637150d8ae146101b2578063adf6180a14610209578063aecc2fd514610236578063c19d93fb14610263578063c97440291461029c578063ebab1a78146102c7578063fbbf93a0146102d1578063fec99b0214610393575b600080fd5b3480156100d657600080fd5b506100df6103cc565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561012d57600080fd5b5061014c600480360381019080803590602001909291905050506103f2565b005b34801561015a57600080fd5b50610179600480360381019080803590602001909291905050506104ce565b005b34801561018757600080fd5b506101a66004803603810190808035906020019092919050505061056a565b005b6101b06105fb565b005b3480156101be57600080fd5b506101c76109b6565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561021557600080fd5b50610234600480360381019080803590602001909291905050506109dc565b005b34801561024257600080fd5b5061026160048036038101908080359060200190929190505050610aa0565b005b34801561026f57600080fd5b50610278610b7c565b6040518082600681111561028857fe5b60ff16815260200191505060405180910390f35b3480156102a857600080fd5b506102b1610b8f565b6040518082815260200191505060405180910390f35b6102cf610b99565b005b3480156102dd57600080fd5b506102e6610d5b565b604051808973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200187815260200186600681111561036057fe5b60ff1681526020018581526020018481526020018381526020018281526020019850505050505050505060405180910390f35b34801561039f57600080fd5b506103a8610dfb565b604051808260068111156103b857fe5b60ff16815260200191505060405180910390f35b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561044e57600080fd5b600380600681111561045c57fe5b600b60009054906101000a900460ff16600681111561047757fe5b14151561048357600080fd5b6008548211156104ca576005600b60006101000a81548160ff021916908360068111156104ac57fe5b02179055506064600354600a028115156104c257fe5b04600a819055505b5050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561052a57600080fd5b600080600681111561053857fe5b600b60009054906101000a900460ff16600681111561055357fe5b14151561055f57600080fd5b816003819055505050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156105c657600080fd5b42600981905550806004819055506000600b60006101000a81548160ff021916908360068111156105f357fe5b021790555050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561065757600080fd5b600480600681111561066557fe5b600b60009054906101000a900460ff16600681111561068057fe5b14151561068c57600080fd5b6002600681111561069957fe5b600b60019054906101000a900460ff1660068111156106b457fe5b141561079757600354341415156106ca57600080fd5b426006819055506001600b60006101000a81548160ff021916908360068111156106f057fe5b02179055506301e13380600654016007819055506224ea0060075401600881905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051600060405180830381858888f19350505050158015610791573d6000803e3d6000fd5b506108eb565b600360068111156107a457fe5b600b60019054906101000a900460ff1660068111156107bf57fe5b14156108a657600a5460035401341415156107d957600080fd5b426006819055506001600b60006101000a81548160ff021916908360068111156107ff57fe5b02179055506301e13380600654016007819055506224ea0060075401600881905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051600060405180830381858888f193505050501580156108a0573d6000803e3d6000fd5b506108ea565b600560068111156108b357fe5b600b60019054906101000a900460ff1660068111156108ce57fe5b14156108e957600a5460035401341415156108e857600080fd5b5b5b5b426006819055506001600b60006101000a81548160ff0219169083600681111561091157fe5b02179055506301e13380600654016007819055506224ea0060075401600881905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051600060405180830381858888f193505050501580156109b2573d6000803e3d6000fd5b5050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610a3857600080fd5b6001806006811115610a4657fe5b600b60009054906101000a900460ff166006811115610a6157fe5b141515610a6d57600080fd5b600754821115610a9c576002600b60006101000a81548160ff02191690836006811115610a9657fe5b02179055505b5050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610afc57600080fd5b6002806006811115610b0a57fe5b600b60009054906101000a900460ff166006811115610b2557fe5b141515610b3157600080fd5b600854821115610b78576003600b60006101000a81548160ff02191690836006811115610b5a57fe5b02179055506064600354600502811515610b7057fe5b04600a819055505b5050565b600b60009054906101000a900460ff1681565b6000600354905090565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610bf557600080fd5b6000806006811115610c0357fe5b600b60009054906101000a900460ff166006811115610c1e57fe5b141515610c2a57600080fd5b60035434141515610c3a57600080fd5b42600681905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc6003549081150290604051600060405180830381858888f19350505050158015610cab573d6000803e3d6000fd5b50600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc6000549081150290604051600060405180830381858888f19350505050158015610d16573d6000803e3d6000fd5b506001600b60006101000a81548160ff02191690836006811115610d3657fe5b02179055506301e13380600654016007819055506224ea006007540160088190555050565b600080600080600080600080600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600054600b60009054906101000a900460ff163073ffffffffffffffffffffffffffffffffffffffff1631600654600754600854975097509750975097509750975097509091929394959697565b600b60019054906101000a900460ff16815600a165627a7a72305820e5f8fa14b76cb56782df593dad97ab5bb4c092390b280c18c7b95f8aae9426af0029a165627a7a72305820ca220d256f9d20a40cccf6e2c1267f5bcdfd5bdcaa1d3734e97bfa3449ec3b640029";
//get the transaction count from account 1 as it is the sender
web3.eth.getTransactionCount(government, (err, txCount) => {
  //Transaction Object
  const txObject = {
    nonce: web3.utils.toHex(txCount), //all paramters should be in Hex
    gasLimit: web3.utils.toHex(4700000),
    gasPrice: web3.utils.toHex(web3.utils.toWei("0", "gwei")),
    data: data
  };

  //Sign a transaction
  const tx = new Tx(txObject);
  tx.sign(privateKeyGovernment);

  const serializedTransaction = tx.serialize();
  const raw = "0x" + serializedTransaction.toString("hex");

  //Broadcast a transaction
  web3.eth.sendSignedTransaction(raw, (err, txHash) => {
    console.log("txHash : ", txHash);
  });
});
