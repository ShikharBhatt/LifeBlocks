const Tx = require("ethereumjs-tx");
const Web3 = require("web3");
const web3 = new Web3("http://127.0.0.1:7545");

const government = "0x5578Ec2cb3994BC87823802071241726EBC40FDF";

const privateKeyGovernment = Buffer.from(process.env.PRIVATE_KEY, "hex");

//console.log(privateKeyGovernment)
const data = "0x60806040527378478e7666bcb38b2ddeddfe7cb0ba152301df076000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503480156100c657600080fd5b5033600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506114f2806101176000396000f30060806040526004361061006d576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680636db026f2146100725780636ebc8c86146100df578063893d20e81461014c5780638ae2dc94146101a35780639399869d1461020d575b600080fd5b34801561007e57600080fd5b5061009d60048036038101908080359060200190929190505050610238565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b3480156100eb57600080fd5b5061010a60048036038101908080359060200190929190505050610276565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561015857600080fd5b50610161610315565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6101cb600480360381019080803590602001909291908035906020019092919050505061033f565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561021957600080fd5b506102226105ea565b6040518082815260200191505060405180910390f35b60028181548110151561024757fe5b906000526020600020016000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156102d457600080fd5b6002828154811015156102e357fe5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b6000600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b600080670de0b6b3a76400003414151561035857600080fd5b3433600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1686610386610653565b808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200193505050506040518091039082f080158015610411573d6000803e3d6000fd5b509050905060028190806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16631358ba4484836040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808381526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200192505050602060405180830381600087803b15801561054157600080fd5b505af1158015610555573d6000803e3d6000fd5b505050506040513d602081101561056b57600080fd5b8101908080519060200190929190505050507fda4818c66aa618a1523d98d1970df0be840e6ab133d89f526b0b8ac6b323761381604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a18091505092915050565b6000600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561064857600080fd5b600280549050905090565b604051610e63806106648339019056006080604052604051606080610e6383398101806040528101908080519060200190929190805190602001909291908051906020019092919050505082600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503460008190555081600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555042600581905550806004819055506000600b60006101000a81548160ff021916908360068111156100f057fe5b0217905550505050610d5c806101076000396000f3006080604052600436106100af576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063105f69ac146100b457806310ec214f146100e157806349b1b0111461010e5780634ad42dbd1461013b578063adf6180a14610145578063aecc2fd514610172578063c19d93fb1461019f578063c9744029146101d8578063ebab1a7814610203578063fbbf93a01461020d578063fec99b02146102cf575b600080fd5b3480156100c057600080fd5b506100df60048036038101908080359060200190929190505050610308565b005b3480156100ed57600080fd5b5061010c600480360381019080803590602001909291905050506103e4565b005b34801561011a57600080fd5b5061013960048036038101908080359060200190929190505050610480565b005b610143610543565b005b34801561015157600080fd5b50610170600480360381019080803590602001909291905050506108fe565b005b34801561017e57600080fd5b5061019d600480360381019080803590602001909291905050506109c2565b005b3480156101ab57600080fd5b506101b4610a9e565b604051808260068111156101c457fe5b60ff16815260200191505060405180910390f35b3480156101e457600080fd5b506101ed610ab1565b6040518082815260200191505060405180910390f35b61020b610abb565b005b34801561021957600080fd5b50610222610c7d565b604051808973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200187815260200186600681111561029c57fe5b60ff1681526020018581526020018481526020018381526020018281526020019850505050505050505060405180910390f35b3480156102db57600080fd5b506102e4610d1d565b604051808260068111156102f457fe5b60ff16815260200191505060405180910390f35b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561036457600080fd5b600380600681111561037257fe5b600b60009054906101000a900460ff16600681111561038d57fe5b14151561039957600080fd5b6008548211156103e0576005600b60006101000a81548160ff021916908360068111156103c257fe5b02179055506064600354600a028115156103d857fe5b04600a819055505b5050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561044057600080fd5b600080600681111561044e57fe5b600b60009054906101000a900460ff16600681111561046957fe5b14151561047557600080fd5b816003819055505050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156104dc57600080fd5b4260098190555080600481905550600b60009054906101000a900460ff16600b60016101000a81548160ff0219169083600681111561051757fe5b02179055506004600b60006101000a81548160ff0219169083600681111561053b57fe5b021790555050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561059f57600080fd5b60048060068111156105ad57fe5b600b60009054906101000a900460ff1660068111156105c857fe5b1415156105d457600080fd5b600260068111156105e157fe5b600b60019054906101000a900460ff1660068111156105fc57fe5b14156106df576003543414151561061257600080fd5b426006819055506001600b60006101000a81548160ff0219169083600681111561063857fe5b02179055506301e13380600654016007819055506224ea0060075401600881905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051600060405180830381858888f193505050501580156106d9573d6000803e3d6000fd5b50610833565b600360068111156106ec57fe5b600b60019054906101000a900460ff16600681111561070757fe5b14156107ee57600a54600354013414151561072157600080fd5b426006819055506001600b60006101000a81548160ff0219169083600681111561074757fe5b02179055506301e13380600654016007819055506224ea0060075401600881905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051600060405180830381858888f193505050501580156107e8573d6000803e3d6000fd5b50610832565b600560068111156107fb57fe5b600b60019054906101000a900460ff16600681111561081657fe5b141561083157600a54600354013414151561083057600080fd5b5b5b5b426006819055506001600b60006101000a81548160ff0219169083600681111561085957fe5b02179055506301e13380600654016007819055506224ea0060075401600881905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051600060405180830381858888f193505050501580156108fa573d6000803e3d6000fd5b5050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561095a57600080fd5b600180600681111561096857fe5b600b60009054906101000a900460ff16600681111561098357fe5b14151561098f57600080fd5b6007548211156109be576002600b60006101000a81548160ff021916908360068111156109b857fe5b02179055505b5050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610a1e57600080fd5b6002806006811115610a2c57fe5b600b60009054906101000a900460ff166006811115610a4757fe5b141515610a5357600080fd5b600854821115610a9a576003600b60006101000a81548160ff02191690836006811115610a7c57fe5b02179055506064600354600502811515610a9257fe5b04600a819055505b5050565b600b60009054906101000a900460ff1681565b6000600354905090565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610b1757600080fd5b6000806006811115610b2557fe5b600b60009054906101000a900460ff166006811115610b4057fe5b141515610b4c57600080fd5b60035434141515610b5c57600080fd5b42600681905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc6003549081150290604051600060405180830381858888f19350505050158015610bcd573d6000803e3d6000fd5b50600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc6000549081150290604051600060405180830381858888f19350505050158015610c38573d6000803e3d6000fd5b506001600b60006101000a81548160ff02191690836006811115610c5857fe5b02179055506301e13380600654016007819055506224ea006007540160088190555050565b600080600080600080600080600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600054600b60009054906101000a900460ff163073ffffffffffffffffffffffffffffffffffffffff1631600654600754600854975097509750975097509750975097509091929394959697565b600b60019054906101000a900460ff16815600a165627a7a7230582096ce0fdbe390fe529889858f37afdd1843d2c7588aeb37984f3f3a9c14c738df0029a165627a7a7230582074933415c6f546ee41ad89f5d510c23e23b849a6328f4cdf02f07262a21ab3f10029";
//get the transaction count from account 1 as it is the sender
web3.eth.getTransactionCount(government, (err, txCount) => {
  //Transaction Object
  const txObject = {
    nonce: web3.utils.toHex(txCount), //all paramters should be in Hex
    gasLimit: web3.utils.toHex(4700000),
    gasPrice: web3.utils.toHex(web3.utils.toWei("0", "gwei")),
    data: data
  };

  //Sign a transaction
  const tx = new Tx(txObject);
  tx.sign(privateKeyGovernment);

  const serializedTransaction = tx.serialize();
  const raw = "0x" + serializedTransaction.toString("hex");

  //Broadcast a transaction
  web3.eth.sendSignedTransaction(raw, (err, txHash) => {
    console.log("txHash : ", txHash);
  });
});
